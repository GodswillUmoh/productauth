<!-- templates/generate.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Generate QR Code</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    .scroll-box {
      max-height: 400px;
      overflow-y: auto;
    }
  </style>
</head>
<body class="container py-4">
  <h2 class="mb-4">Generate Product QR Codes</h2>

  <form method="post">
  {% csrf_token %}
  <div class="mb-3">
    <label for="product_name" class="form-label">Product Name:</label>
    <input type="text" name="product_name" class="form-control" id="product_name" required>
  </div>

  <div class="mb-3">
    <label for="num_codes" class="form-label">Number of codes to generate:</label>
    <input type="number" name="num_codes" class="form-control" id="num_codes" min="1" max="100" value="5" required>
  </div>

  <button type="submit" class="btn btn-primary">Generate</button>
</form>

  {% if codes %}
    <hr>
    <h4 class="mt-4">Recently Generated Codes</h4>
    <div class="row scroll-box">
      <div class="row">
  {% for code in codes %}
    <div class="col-md-4 mb-3 code-item {% if forloop.counter > 6 %}d-none extra-code{% endif %}">
      <div class="card">
        <img src="{{ code.qr_code_image.url }}" class="card-img-top" alt="QR Code">
        <div class="card-body">
          <p class="card-text"><strong>Product:</strong> {{ code.product_name }}</p>
          <p class="card-text"><strong>Code:</strong> {{ code.code }}</p>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

{% if codes|length > 6 %}
  <div class="text-center mt-3">
    <button id="view-more" class="btn btn-primary">View More</button>
  </div>
{% endif %}

    <div class="mt-4">
      <a href="{% url 'download_all_codes_pdf' %}" class="btn btn-outline-success">Download All (PDF)</a>
      <a href="{% url 'download_all_codes_zip' %}" class="btn btn-outline-info">Download All (ZIP)</a>
    </div>
  {% endif %}

  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const btn = document.getElementById("view-more");
    if (btn) {
      btn.addEventListener("click", function () {
        document.querySelectorAll('.extra-code').forEach(el => el.classList.remove('d-none'));
        btn.style.display = 'none'; // Hide button after showing all
      });
    }
  });
</script>

</body>
</html>
