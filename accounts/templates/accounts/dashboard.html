{% extends 'base.html' %}
{% block title %}Dashboard | BingChecks{% endblock %}
{% block content %}
<br><br>
<div class="container mt-5">
    <h2 class="mb-4">Welcome, {{ user.username }}!</h2>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm border-0 text-center p-3">
                <h5 class="card-title">Generate Code</h5>
                <p>Create QR codes for your products.</p>
                <a href="{% url 'authentication:generate_code' %}" class="btn btn-primary">Generate Codes</a>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-0 text-center p-3">
                <h5>Your Generated Codes</h5>
                <p>Total: <strong>{{ codes_count }}</strong></p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm border-0 text-center p-3">
                <h5>Account Settings</h5>
                <p>Manage your account</p>
                <a href="{% url 'accounts:logout' %}" class="btn btn-secondary">Logout</a>
            </div>
        </div>
    </div>

  <!-- Filter Card -->
<div class="card shadow-sm mb-4">
  <div class="card-header text-white" style="background-color: #040005;">
    <h5 class="mb-0">ðŸ“… Filter by Date to Download Selected Codes</h5>
  </div>
  <div class="card-body">
    <form method="get" class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label fw-semibold">Start Date</label>
        <input type="date" name="start_date" value="{{ start_date }}" class="form-control">
      </div>

      <div class="col-md-4">
        <label class="form-label fw-semibold">End Date</label>
        <input type="date" name="end_date" value="{{ end_date }}" class="form-control">
      </div>

      <div class="col-md-4">
        <button type="submit" class="btn text-white w-100" style="background-color: #7B1FA2;">
          Filter
        </button>

        {% if start_date and end_date %}
          <a href="{% url 'accounts:download_selected' %}?start_date={{ start_date }}&end_date={{ end_date }}"
             class="btn btn-success w-100 mt-2">
             Download All Filtered
          </a>
        {% endif %}
      </div>
    </form>
  </div>
</div>


    <!-- Codes Table -->
    <h4 class="mb-3">Generated Products</h4>
    <div class="table-responsive">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Product</th>
                    <th>QR</th>
                    <th>Code</th>
                    <th>Created</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for code in codes %}
                <tr>
                    <td>{{ code.product_name }}</td>
                    <td class="text-center">
                        <img src="data:image/png;base64,{{ code.image_base64 }}" width="80" height="80">
                        <br>
                        <a download="{{ code.product_name }}_code.png" 
                           href="data:image/png;base64,{{ code.image_base64 }}" 
                           class="btn btn-sm btn-outline-primary mt-2">Download</a>
                    </td>
                    <td>{{ code.code }}</td>
                    <td>{{ code.created_at|date:"M d, Y H:i" }}</td>
                    <td>{% if code.used %}Used{% else %}Unused{% endif %}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center">No codes found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="text-center mt-4">
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if start_date and end_date %}&start_date={{ start_date }}&end_date={{ end_date }}{% endif %}" 
               class="btn btn-outline-secondary">View More</a>
        {% endif %}
    </div>
</div>
{% endblock %}
